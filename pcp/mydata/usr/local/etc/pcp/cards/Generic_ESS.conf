#!/bin/sh
# Version: 3.03 2016-29-11
# First version to load audio settings via conf files so Extra soundcards also can be supplied by third-parties. SBP

. /home/tc/www/cgi-bin/pcp-soundcard-functions
pcp_AudioKernel_status
#========================================================================================
# Load the correct modules for Generic ESS 9023 DAC
#----------------------------------------------------------------------------------------
CARD="Generic ESS 9023 I2S DAC"
OUTPUT="hw:CARD=es9023"
ALSA_PARAMS="80:4::1"
GENERIC_CARD="ES9023"
CONTROL_PAGE="soundcard_control.cgi"
LISTNAME='Generic ESS9023 DAC'
RPI_MODEL="HAT_ALL_NO_HAT"

if [ "$KERNELVERSION" = "Audiokernel" ]; then
DTOVERLAY='es9023-audio'
TEXT="Choosing <b>384k</b> will enable 352k and 384k sample rates. Selecting <b>bclk_ratio_int_div</b> will use bclk_ratio=50 for 16/24bps and bclk_ratio=100 for 32bps media when sample rate is a multiple of 8kHz and less than 192kHz. Which causes the selection of the 19M2 OSC as the parent for the PCM clock with an integer divider, rather than PLLD with fractional divider and MASH noise shaping."
PARAMS1="384k"
PARAMS2="bclk_ratio_int_div"
else
TEXT='Sorry this DAC cannot be controlled as it has no ALSA controls.'
DTOVERLAY="hifiberry-dac"
fi