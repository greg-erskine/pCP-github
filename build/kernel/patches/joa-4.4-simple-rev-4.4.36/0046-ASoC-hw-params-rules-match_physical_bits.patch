From 83d2b5a999a512f07bb214a6ac212a8d0fc04376 Mon Sep 17 00:00:00 2001
From: Clive Messer <clive.messer@digitaldreamtime.co.uk>
Date: Tue, 17 May 2016 08:39:12 +0000
Subject: [PATCH 46/65] ASoC: hw-params-rules: match_physical_bits

Add asoc_generic_hw_params_match_physical_bits method.

Signed-off-by: DigitalDreamtime <clive.messer@digitaldreamtime.co.uk>
---
 sound/soc/generic/hw-params-rules.c | 20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/sound/soc/generic/hw-params-rules.c b/sound/soc/generic/hw-params-rules.c
index 5a9bae5..7590d12 100644
--- a/sound/soc/generic/hw-params-rules.c
+++ b/sound/soc/generic/hw-params-rules.c
@@ -74,7 +74,7 @@ static int asoc_generic_hw_params_read_u32(
 	return of_property_read_u32(node, "value", (u32 *)data);
 }
 
-static int asoc_generic_hw_params_match_sample_bits(
+static int asoc_generic_hw_params_match_physical_bits(
 	struct snd_pcm_substream *substream,
 	struct snd_pcm_hw_params *params,
 	void *data)
@@ -92,6 +92,23 @@ static int asoc_generic_hw_params_match_sample_bits(
 	return 0;
 }
 
+static int asoc_generic_hw_params_match_sample_bits(
+	struct snd_pcm_substream *substream,
+	struct snd_pcm_hw_params *params,
+	void *data)
+{
+	long int bits = snd_pcm_format_width(params_format(params));
+	struct snd_soc_size_u32array *array = data;
+	int i;
+
+	for (i = 0; i < array->size; i++) {
+		if (bits == array->data[i])
+			return 1;
+	}
+
+	return 0;
+}
+
 static int asoc_generic_hw_params_match_channels(
 	struct snd_pcm_substream *substream,
 	struct snd_pcm_hw_params *params,
@@ -196,6 +213,7 @@ struct asoc_generic_hw_params_method {
 
 static const struct asoc_generic_hw_params_method
 asoc_generic_hw_params_methods[] = {
+	HW_PARAMS_METHOD_U32ARRAY(asoc_generic_hw_params_match_physical_bits),
 	HW_PARAMS_METHOD_U32ARRAY(asoc_generic_hw_params_match_sample_bits),
 	HW_PARAMS_METHOD_U32ARRAY(asoc_generic_hw_params_match_rate),
 	HW_PARAMS_METHOD_U32(asoc_generic_hw_params_match_rate_gt),
-- 
2.7.4

